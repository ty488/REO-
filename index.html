<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detroit ZIP Code Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
    .filter-container {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 8px;
      font-family: Arial, sans-serif;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .zip-label {
      font-weight: bold;
      color: black;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="filter-container">
    <label><strong>Filters</strong></label><br><br>

    <label>Residential Vacancy (%):</label><br>
    <input type="range" id="vacancyFilter" min="0" max="100" value="0"> <span id="vacancyVal">0%</span><br><br>

    <label>Crime Level:</label><br>
    <select id="crimeFilter">
      <option value="all">All</option>
      <option value="low">Low</option>
      <option value="medium">Medium</option>
      <option value="high">High</option>
    </select><br><br>

    <label>Income Level:</label><br>
    <select id="incomeFilter">
      <option value="all">All</option>
      <option value="low">Low</option>
      <option value="middle">Middle</option>
      <option value="high">High</option>
    </select><br><br>

    <label>Education:</label><br>
    <select id="educationFilter">
      <option value="all">All</option>
      <option value="hs">High School Diploma</option>
      <option value="college">College Degree</option>
      <option value="masters">Master's Degree</option>
    </select>
  </div>

  <div id="map"></div>

  <script>
    var map = L.map("map").setView([42.3314, -83.0458], 11);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
    }).addTo(map);

    // Placeholder for real Detroit ZIP polygons
    var zipPolygons = {}; // key: ZIP code, value: polygon layer

    async function loadDetroitZCTAs() {
      // Replace this URL with real Detroit ZCTA GeoJSON
      const url = 'https://data-wayne.opendata.arcgis.com/api/download/v1/items/69f4a2d5a18e4507b8a9c64757ca7dcb/geojson?layers=0';
      const resp = await fetch(url);
      const geojson = await resp.json();

      L.geoJSON(geojson, {
        style: function(feature) {
          return { color: 'black', weight: 2, fillColor: 'white', fillOpacity: 0.8 };
        },
        onEachFeature: function(feature, layer) {
          const zip = feature.properties.ZCTA5CE10;
          zipPolygons[zip] = layer;
          layer.bindTooltip(zip, { permanent: true, direction: 'center', className: 'zip-label' });
        }
      }).addTo(map);
    }

    function applyFilters() {
      const vacancyLimit = +document.getElementById('vacancyFilter').value;
      const crimeVal = document.getElementById('crimeFilter').value;
      const incomeVal = document.getElementById('incomeFilter').value;
      const eduVal = document.getElementById('educationFilter').value;

      // Placeholder sample data for each ZIP
      const zipData = {
        '48201': { vacancy: 12, crime: 'high', income: 'low', education: 'college' },
        '48202': { vacancy: 8, crime: 'medium', income: 'middle', education: 'hs' },
        '48203': { vacancy: 25, crime: 'high', income: 'low', education: 'hs' },
        '48204': { vacancy: 18, crime: 'medium', income: 'low', education: 'masters' }
      };

      for (let zip in zipPolygons) {
        const layer = zipPolygons[zip];
        const d = zipData[zip] || {};
        let visible = true;

        if (d.vacancy != null && d.vacancy < vacancyLimit) visible = false;
        if (crimeVal !== 'all' && d.crime !== crimeVal) visible = false;
        if (incomeVal !== 'all' && d.income !== incomeVal) visible = false;
        if (eduVal !== 'all' && d.education !== eduVal) visible = false;

        layer.setStyle({ fillOpacity: visible ? 0.8 : 0, opacity: visible ? 1 : 0 });
      }
    }

    document.getElementById('vacancyFilter').addEventListener('input', function() {
      document.getElementById('vacancyVal').innerText = this.value + '%';
      applyFilters();
    });
    document.getElementById('crimeFilter').addEventListener('change', applyFilters);
    document.getElementById('incomeFilter').addEventListener('change', applyFilters);
    document.getElementById('educationFilter').addEventListener('change', applyFilters);

    loadDetroitZCTAs();
  </script>
</body>
</html>
